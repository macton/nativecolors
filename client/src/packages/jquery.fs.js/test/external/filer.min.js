var self=this;self.URL=self.URL||self.webkitURL;self.requestFileSystem=self.requestFileSystem||self.webkitRequestFileSystem;self.resolveLocalFileSystemURL=self.resolveLocalFileSystemURL||self.webkitResolveLocalFileSystemURL;self.storageInfo=self.storageInfo||self.webkitStorageInfo;self.BlobBuilder=self.BlobBuilder||self.MozBlobBuilder||self.WebKitBlobBuilder;if(void 0===self.FileError){var FileError=function(){};FileError.prototype.prototype=Error.prototype}
var Util={toArray:function(a){return Array.prototype.slice.call(a||[],0)},strToDataURL:function(a,c,b){return(void 0!=b?b:1)?"data:"+c+";base64,"+self.btoa(a):"data:"+c+","+a},strToObjectURL:function(a,c){for(var b=new Uint8Array(a.length),e=0;e<b.length;++e)b[e]=a.charCodeAt(e);e=new BlobBuilder;e.append(b.buffer);b=c?e.getBlob(c):e.getBlob();return self.URL.createObjectURL(b)},fileToObjectURL:function(a){return self.URL.createObjectURL(a)},fileToArrayBuffer:function(a,c,b){var e=new FileReader;
e.onload=function(b){c(b.target.result)};e.onerror=function(a){b&&b(a)};e.readAsArrayBuffer(a)},dataURLToBlob:function(a){if(-1==a.indexOf(";base64,")){var c=a.split(","),a=c[0].split(":")[1],c=c[1],b=new BlobBuilder;b.append(c);return b.getBlob(a)}for(var c=a.split(";base64,"),a=c[0].split(":")[1],c=window.atob(c[1]),b=c.length,e=new Uint8Array(b),g=0;g<b;++g)e[g]=c.charCodeAt(g);b=new BlobBuilder;b.append(e.buffer);return b.getBlob(a)},arrayBufferToBlob:function(a,c){var b=new BlobBuilder;b.append(a);
return c?b.getBlob(c):b.getBlob()},arrayBufferToBinaryString:function(a,c,b){var e=new FileReader;e.onload=function(b){c(b.target.result)};e.onerror=function(a){b&&b(a)};var g=new BlobBuilder;g.append(a);e.readAsBinaryString(g.getBlob())},arrayToBinaryString:function(a){if("object"!=typeof a)return null;for(var c=a.length,b=Array(c);c--;)b[c]=String.fromCharCode(a[c]);return b.join("")},getFileExtension:function(a){var c=a.lastIndexOf(".");return-1!=c?a.substring(c):""}},MyFileError=function(a){this.prototype=
FileError.prototype;this.code=a.code;this.name=a.name};FileError.BROWSER_NOT_SUPPORTED=1E3;FileError.prototype.__defineGetter__("name",function(){for(var a=Object.keys(FileError),c=0,b;b=a[c];++c)if(FileError[b]==this.code)return b;return"Unknown Error"});
var Filer=new function(){function a(d){if(c=d||null)b=c.root,e=!0}var c=null,b=null,e=!1,g=function(d){return 0==d.indexOf("filesystem:")},i=function(d){g(d)||(d="/"==d[0]?c.root.toURL()+d.substring(1):0==d.indexOf("./")||0==d.indexOf("../")?"../"==d&&b!=c.root?b.toURL()+"/"+d:b.toURL()+d:b.toURL()+"/"+d);return d},k=function(d,b){var a=arguments[1],c=arguments[2],h=function(d){if(d.code==FileError.NOT_FOUND_ERR){if(c)throw Error('"'+a+'" or "'+c+'" does not exist.');throw Error('"'+a+'" does not exist.');
}throw Error("Problem getting Entry for one or more paths.");},e=i(a);if(3==arguments.length){var j=i(c);self.resolveLocalFileSystemURL(e,function(a){self.resolveLocalFileSystemURL(j,function(b){d(a,b)},h)},h)}else self.resolveLocalFileSystemURL(e,d,h)},m=function(d,a,b,f,h,e){if(!c)throw Error("Filesystem has not been initialized.");if(typeof d!=typeof a)throw Error("These method arguments are not supported.");var j=b||null,g=void 0!=e?e:!1;(d.isFile||a.isDirectory)&&a.isDirectory?g?d.moveTo(a,j,
f,h):d.copyTo(a,j,f,h):k(function(d,a){if(a.isDirectory)g?d.moveTo(a,j,f,h):d.copyTo(a,j,f,h);else{var b=Error('Oops! "'+a.name+" is not a directory!");if(h)h(b);else throw b;}},d,a)};a.DEFAULT_FS_SIZE=1048576;a.prototype={get fs(){return c},get isOpen(){return e}};a.prototype.pathToFilesystemURL=function(d){return i(d)};a.prototype.init=function(d,a,l){if(!self.requestFileSystem)throw new MyFileError({code:FileError.BROWSER_NOT_SUPPORTED,name:"BROWSER_NOT_SUPPORTED"});var d=d?d:{},f=d.size||1048576;
this.type=self.TEMPORARY;if("persistent"in d&&d.persistent)this.type=self.PERSISTENT;var h=function(d){this.size=f;c=d;b=c.root;e=!0;a&&a(d)};this.type==self.PERSISTENT?self.webkitStorageInfo.requestQuota(this.type,f,function(d){self.requestFileSystem(this.type,d,h.bind(this),l)}.bind(this),l):self.requestFileSystem(this.type,f,h.bind(this),l)};a.prototype.ls=function(d,a,e){if(!c)throw Error("Filesystem has not been initialized.");var f=function(d){b=d;var c=[],f=b.createReader(),g=function(){f.readEntries(function(d){d.length?
(c=c.concat(Util.toArray(d)),g()):(c.sort(function(d,a){return d.name<a.name?-1:a.name<d.name?1:0}),a(c))},e)};g()};d.isDirectory?f(d):g(d)?k(f,i(d)):b.getDirectory(d,{},f,e)};a.prototype.mkdir=function(d,a,e,f){if(!c)throw Error("Filesystem has not been initialized.");var h=null!=a?a:!1,g=d.split("/"),j=function(a,b){if("."==b[0]||""==b[0])b=b.slice(1);a.getDirectory(b[0],{create:!0,exclusive:h},function(a){if(a.isDirectory)b.length&&1!=g.length?j(a,b.slice(1)):e(a);else if(a=Error(d+" is not a directory"),
f)f(a);else throw a;},function(a){if(a.code==FileError.INVALID_MODIFICATION_ERR)if(a.message="'"+d+"' already exists",f)f(a);else throw a;})};j(b,g)};a.prototype.open=function(a,b,e){if(!c)throw Error("Filesystem has not been initialized.");a.isFile?a.file(b,e):k(function(a){a.file(b,e)},i(a))};a.prototype.create=function(a,e,g,f){if(!c)throw Error("Filesystem has not been initialized.");b.getFile(a,{create:!0,exclusive:null!=e?e:!0},g,function(b){if(b.code==FileError.INVALID_MODIFICATION_ERR)b.message=
"'"+a+"' already exists";if(f)f(b);else throw b;})};a.prototype.mv=function(a,b,c,e,h){m.bind(this,a,b,c,e,h,!0)()};a.prototype.rm=function(a,b,e){if(!c)throw Error("Filesystem has not been initialized.");var f=function(a){a.isFile?a.remove(b,e):a.isDirectory&&a.removeRecursively(b,e)};a.isFile||a.isDirectory?f(a):k(f,a)};a.prototype.cd=function(a,e,g){if(!c)throw Error("Filesystem has not been initialized.");a.isDirectory?(b=a,e&&e(b)):(a=i(a),k(function(a){if(a.isDirectory)b=a,e&&e(b);else if(a=
Error("Path was not a directory."),g)g(a);else throw a;},a))};a.prototype.cp=function(a,b,c,e,g){m.bind(this,a,b,c,e,g)()};a.prototype.write=function(a,e,i,f){if(!c)throw Error("Filesystem has not been initialized.");var h=function(a){a.createWriter(function(b){b.onerror=f;if(e.append)b.onwriteend=function(){i(a,this)},b.seek(b.length);else{var c=!1;b.onwriteend=function(){c?i(a,this):(c=!0,this.truncate(this.position))}}var d=new BlobBuilder;d.append(e.data);b.write(e.type?d.getBlob(e.type):d.getBlob())},
f)};a.isFile?h(a):g(a)?k(h,a):b.getFile(a,{create:!0,exclusive:!1},h,f)};return a};
